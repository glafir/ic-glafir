%table.table.table-striped.table-hover.table-condensed
  %tr
    %th= sortable "iata_code"
    %th= sortable "icao_code"
    %th= sortable "name_rus"
    %th= sortable "city_rus"
    %th= sortable "latitude"
    %th= sortable "longitude"
    %th Dist to town
    %th= sortable "iso_code"
    %th Runway
    %th Расписание и табло.
    %th Кол-во рейсов всего||отправлено/принято
    %th
    %th
    %th
  - @airports.each do |airport|
    %tr
      - if  airport.name_rus.blank?
        - airport.name = airport.name_eng
      - else
        - airport.name = airport.name_rus
      - if  airport.city_rus.blank?
        - airport.city_name = airport.city_eng
      - else
        - airport.city_name = airport.city_rus
      - if  airport.town.blank?
        - city = airport.city_name
      - else
        - if airport.town.city_rus.blank?
          - city = airport.town.accent_city
        - else
          - city = airport.town.city_rus
      %td= airport.iata_code
      %td= airport.icao_code
      %td= link_to airport.name, airport
      %td= link_to city, country_town_path(airport.country, airport.town_id) unless airport.town.blank?
      %td
        = airport.latitude
        %br
        #{airport.town.latitude}
      %td
        = airport.longitude
        %br
        #{airport.town.longitude}
      %td
        #{airport.distance_from(airport.town, :units=>:kms) unless airport.town.latitude.blank?} kms
      %td= airport.country.country_iata_code
      %td= airport.runway_aps.count
      %td
        %a{:href => "/airports/#{airport.id}/tablo/out"} вылет
        %a{:href => "/airports/#{airport.id}/tablo/in"} прилёт
        %a{:href => "/airports/#{airport.id}/tablo"} Общее
      %td
        - Time.zone = airport.time_zone
        - @wday = Time.zone.now.strftime'%w'.to_s
        - @aptt_in = airport.apkey.timetableaps.where(way_end: airport.id).where("e#{@wday} = ?",1).count
        - @aptt_out = airport.timetableaps.where(way_start: airport.id).where("e#{@wday} = ?",1).count
        - @aptt_all = @aptt_in + @aptt_out or 0
        = @aptt_all
        ||#{@aptt_out}/#{@aptt_in}
      - if policy(airport).edit?
        %td= link_to 'Edit', edit_airport_path(airport)
      - if policy(airport).destroy?
        %td= link_to 'Destroy', airport, method: :delete, data: { confirm: "Вы уверены, что хотите удалить аэропорт "+airport.name_rus+" в городе "+ airport.city_rus}
